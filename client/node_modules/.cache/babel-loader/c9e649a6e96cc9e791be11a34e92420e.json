{"ast":null,"code":"import _regeneratorRuntime from\"/Users/eyallevyg/developer/ghost_climber/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/eyallevyg/developer/ghost_climber/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/eyallevyg/developer/ghost_climber/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import axios from'axios';import AuthContext from'./authContext';import authReducer from'./authReducer';import setAuthToken from'../../utils/setAuthToken';import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS,LOADING}from'../types';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),user:null,isAuthenticated:null,loading:true,error:null};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Loading true\nvar loadingAuth=function loadingAuth(){dispatch({type:LOADING});};// Load User\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:loadingAuth();if(localStorage.token){setAuthToken(localStorage.token);}_context.prev=2;_context.next=5;return axios.get('/api/v1/auth/me');case 5:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);dispatch({type:AUTH_ERROR});case 12:case\"end\":return _context.stop();}}},_callee,null,[[2,9]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();// Register User\nvar register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:loadingAuth();config={headers:{'Content-Type':'application/json'}};_context2.prev=2;_context2.next=5;return axios.post('api/v1/auth/register',formData,config);case 5:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](2);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[2,10]]);}));return function register(_x){return _ref2.apply(this,arguments);};}();// Login User\nvar login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:loadingAuth();config={headers:{'Content-Type':'application/json'}};_context3.prev=2;_context3.next=5;return axios.post('api/v1/auth/login',formData,config);case 5:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](2);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[2,10]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();// Logout\nvar logout=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:loadingAuth();_context4.prev=1;_context4.next=4;return axios.get('api/v1/auth/logout');case 4:dispatch({type:LOGOUT});_context4.next=9;break;case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](1);case 9:case\"end\":return _context4.stop();}}},_callee4,null,[[1,7]]);}));return function logout(){return _ref4.apply(this,arguments);};}();// Clear Errors\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,user:state.user,isAuthenticated:state.isAuthenticated,loading:state.loading,error:state.error,register:register,login:login,logout:logout,clearErrors:clearErrors,loadUser:loadUser,loadingAuth:loadingAuth}},props.children);};export default AuthState;","map":{"version":3,"sources":["/Users/eyallevyg/developer/ghost_climber/client/src/context/auth/AuthState.js"],"names":["React","useReducer","axios","AuthContext","authReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","LOADING","AuthState","props","initialState","token","localStorage","getItem","user","isAuthenticated","loading","error","state","dispatch","loadingAuth","type","loadUser","get","res","payload","data","register","formData","config","headers","post","response","msg","login","logout","clearErrors","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\nimport axios from 'axios';\nimport AuthContext from './authContext';\nimport authReducer from './authReducer';\nimport setAuthToken from '../../utils/setAuthToken';\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERRORS,\n  LOADING,\n} from '../types';\n\nconst AuthState = (props) => {\n  const initialState = {\n    token: localStorage.getItem('token'),\n    user: null,\n    isAuthenticated: null,\n    loading: true,\n    error: null,\n  };\n\n  const [state, dispatch] = useReducer(authReducer, initialState);\n\n  // Loading true\n  const loadingAuth = () => {\n    dispatch({ type: LOADING });\n  };\n\n  // Load User\n\n  const loadUser = async () => {\n    loadingAuth();\n    if (localStorage.token) {\n      setAuthToken(localStorage.token);\n    }\n\n    try {\n      const res = await axios.get('/api/v1/auth/me');\n\n      dispatch({ type: USER_LOADED, payload: res.data });\n    } catch (err) {\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n\n  // Register User\n\n  const register = async (formData) => {\n    loadingAuth();\n    const config = {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    try {\n      const res = await axios.post('api/v1/auth/register', formData, config);\n\n      dispatch({\n        type: REGISTER_SUCCESS,\n        payload: res.data,\n      });\n\n      loadUser();\n    } catch (err) {\n      dispatch({\n        type: REGISTER_FAIL,\n        payload: err.response.data.msg,\n      });\n    }\n  };\n\n  // Login User\n\n  const login = async (formData) => {\n    loadingAuth();\n    const config = {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    try {\n      const res = await axios.post('api/v1/auth/login', formData, config);\n\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: res.data,\n      });\n\n      loadUser();\n    } catch (err) {\n      dispatch({\n        type: LOGIN_FAIL,\n        payload: err.response.data.msg,\n      });\n    }\n  };\n\n  // Logout\n\n  const logout = async () => {\n    loadingAuth();\n    try {\n      await axios.get('api/v1/auth/logout');\n      dispatch({ type: LOGOUT });\n    } catch (err) {}\n  };\n\n  // Clear Errors\n\n  const clearErrors = () => dispatch({ type: CLEAR_ERRORS });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        token: state.token,\n        user: state.user,\n        isAuthenticated: state.isAuthenticated,\n        loading: state.loading,\n        error: state.error,\n        register,\n        login,\n        logout,\n        clearErrors,\n        loadUser,\n        loadingAuth,\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}